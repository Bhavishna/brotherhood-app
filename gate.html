<!DOCTYPE html>
<html>
<head><script src="https://cdn.tailwindcss.com"></script></head>
<body class="bg-slate-950 text-white p-6 flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full bg-slate-900 p-8 rounded-2xl border border-emerald-500/30">
        <h2 class="text-emerald-500 font-bold text-xs uppercase mb-4">Help a Brother First</h2>
        <div id="burdenDisplay" class="italic text-lg mb-6 text-slate-300">"Loading..."</div>
        <textarea id="reply" class="w-full bg-slate-800 p-4 rounded mb-4 outline-none focus:ring-1 focus:ring-emerald-500" placeholder="Give strength (min 10 chars)"></textarea>
        <button id="unlockBtn" class="w-full bg-emerald-600 py-3 rounded font-bold">Unlock Community</button>
    </div>
    <script type="module">
        import { db, auth } from './app.js';
        import { collection, getDocs, updateDoc, doc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        let targetId = "";
        const snap = await getDocs(collection(db, "burdens"));
        const others = snap.docs.filter(d => d.data().author !== auth.currentUser?.uid);
        
        if(others.length > 0) {
            const random = others[Math.floor(Math.random() * others.length)];
            targetId = random.id;
            document.getElementById('burdenDisplay').innerText = `"${random.data().text}"`;
        } else { window.location.href = 'dashboard.html'; }

        document.getElementById('unlockBtn').onclick = async () => {
            const val = document.getElementById('reply').value;
            if(val.length < 10) return alert("Write more...");
            await updateDoc(doc(db, "burdens", targetId), { strengths: arrayUnion(val) });
            window.location.href = 'dashboard.html';
        };
    </script>
</body>
</html>